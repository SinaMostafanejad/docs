---
title: Reference Architecture
description: W&B リファレンス アーキテクチャー
menu:
  default:
    identifier: ja-guides-hosting-hosting-options-self-managed-ref-arch
    parent: self-managed
weight: 1
---

このページでは、Weights & Biases デプロイメントの参考となるアーキテクチャーについて説明し、プラ​​ットフォームをプロダクションデプロイメントでサポートするための推奨インフラストラクチャーとリソースの概要を説明します。

Weights & Biases (W&B) のデプロイメント環境を選択する際、デプロイメントの回復力を向上させるためにさまざまなサービスを利用できます。

たとえば、大手クラウドプロバイダは、データベースの設定、メンテナンス、高可用性、および回復性の複雑性を軽減する強力なマネージドデータベースサービスを提供しています。

この参考アーキテクチャーでは、一般的なデプロイメントシナリオに対処し、W&B デプロイメントをクラウドベンダーサービスと統合して最適なパフォーマンスと信頼性を実現する方法を示します。

## 始める前に

プロダクションでアプリケーションを実行する際には、それに伴う課題がついてきますが、W&Bも例外ではありません。プロセスを合理化することを目指していますが、ユニークなアーキテクチャーや設計の決定に応じて、特定の複雑さが生じることがあります。通常、プロダクションデプロイメントの管理には、ハードウェア、オペレーティングシステム、ネットワーキング、ストレージ、セキュリティ、W&B プラットフォーム自体、およびその他の依存関係を監視することが含まれます。この責任は、環境の初期セットアップとその継続的なメンテナンスの両方に及びます。

W&B 自己管理型アプローチがあなたのチームと特定の要件に適しているかどうかを慎重に検討してください。

プロダクションレベルのアプリケーションを実行および維持する方法に関する強い理解は、自己管理型 W&B をデプロイする前の重要な前提条件です。チームが支援を必要とする場合は、当社のプロフェッショナルサービスチームおよびパートナーが、実装および最適化のサポートを提供します。

W&B を自管理するのではなく、マネージドソリューションについて詳しく知りたい場合は、[W&B マルチテナントクラウド]({{< relref path="/guides/hosting/hosting-options/saas_cloud.md" lang="ja" >}}) と [W&B 専用クラウド]({{< relref path="/guides/hosting/hosting-options/dedicated_cloud.md" lang="ja" >}}) を参照してください。

## インフラストラクチャー

{{< img src="/images/hosting/reference_architecture.png" alt="W&B インフラストラクチャー図" >}}

### アプリケーション層

アプリケーション層は、ノード障害に対する回復力を備えたマルチノード Kubernetes クラスターで構成されます。Kubernetes クラスターは W&B のポッドを実行および維持します。

### ストレージ層

ストレージ層は、MySQL データベースとオブジェクトストレージで構成されます。MySQL データベースはメタデータを保存し、オブジェクトストレージはモデルやデータセットなどのアーティファクトを保存します。

## インフラストラクチャー要件

### Kubernetes
W&B サーバーアプリケーションは、複数のポッドをデプロイする [Kubernetes オペレーター]({{< relref path="kubernetes-operator/" lang="ja" >}}) としてデプロイされます。このため、W&B には以下の要件のある Kubernetes クラスターが必要です:
- 完全に設定され、動作する Ingress コントローラ。
- 永続ボリュームをプロビジョニングする機能。

### MySQL
W&B は、メタデータを MySQL データベースに保存します。データベースのパフォーマンスとストレージ要件は、モデルパラメーターの形状および関連するメタデータに依存します。たとえば、より多くのトレーニング run を追跡するとデータベースのサイズが増加し、run テーブル、ユーザーワークスペース、レポートでのクエリに基づいてデータベースへの負荷が増加します。

自己管理型 MySQL データベースをデプロイする際に次の点を考慮してください：

- **バックアップ**。データベースを別の施設に定期的にバックアップする必要があります。W&B は、少なくとも1週間の保持期間での毎日バックアップを推奨します。
- **パフォーマンス**。サーバーが実行されているディスクは高速でなければなりません。W&B は、SSD または高速化された NAS でデータベースを実行することを推奨します。
- **監視**。データベースは負荷の観点から監視する必要があります。システムの CPU 使用率が5分以上にわたって40%を超える場合、サーバーがリソース不足であることを示す良い兆候です。
- **可用性**。可用性と耐久性の要件に応じて、プライマリサーバーからリアルタイムですべての更新をストリーミングする別のマシンでホットスタンバイを構成し、プライマリサーバーがクラッシュしたり破損したりした場合にフェイルオーバーすることできるようにしたいかもしれません。

### オブジェクトストレージ
W&B には、次のいずれかにデプロイされた Pre-signed URL と CORS サポートを備えたオブジェクトストレージが必要です:
- Amazon S3
- Azure Cloud Storage
- Google Cloud Storage
- Amazon S3 互換のストレージサービス

### バージョン
| ソフトウェア   | 最小バージョン                           |
| ------------ | ---------------------------------------- |
| Kubernetes   | v1.29                                    |
| MySQL        | v8.0.0, "一般利用可能" リリースのみ      |

### ネットワーキング

ネットワーク接続されたデプロイメントの場合、_インストール時_ およびランタイムの両方でこれらのエンドポイントへの送信が必要です:
* https://deploy.wandb.ai
* https://charts.wandb.ai
* https://docker.io
* https://quay.io
* `https://gcr.io`

エアギャップデプロイメントについて学ぶには、[エアギャップインスタンス用 Kubernetes オペレーター]({{< relref path="kubernetes-operator/operator-airgapped.md" lang="ja" >}}) を参照してください。
W&B へのアクセスとオブジェクトストレージへのアクセスは、トレーニングインフラストラクチャーと実験のニーズを追跡する各システムに対して必要です。

### DNS
W&B デプロイメントの完全修飾ドメイン名 (FQDN) は、A レコードを使用して Ingress/ロードバランサーの IP アドレスに解決する必要があります。

### SSL/TLS
W&B は、クライアントとサーバー間の安全な通信のために、有効な署名済みの SSL/TLS 証明書を必要とします。SSL/TLS 終端は Ingress/ロードバランサーで発生する必要があります。W&B サーバーアプリケーションは SSL または TLS 接続を終端しません。

ご注意: W&B は自己署名証明書およびカスタム CA の使用を推奨しません。

### サポートされている CPU アーキテクチャー
W&B は Intel (x86) CPU アーキテクチャーで実行されます。ARM はサポートされていません。

## インフラストラクチャープロビジョニング
Terraform は、プロダクション用に W&B をデプロイするための推奨方法です。Terraform を使用すると、必要なリソース、それらの他のリソースに対する参照、及び依存関係を定義します。W&B は、主要なクラウドプロバイダ向けの Terraform モジュールを提供しています。詳細については、[自己管理型クラウドアカウント内での W&B サーバーのデプロイ]({{< relref path="/guides/hosting/hosting-options/self-managed.md#deploy-wb-server-within-self-managed-cloud-accounts" lang="ja" >}}) を参照してください。

## サイズ設定
デプロイメントを計画する際の出発点として、次の一般的なガイドラインを使用してください。W&B は、新しいデプロイメントのすべてのコンポーネントを緊密に監視し、観察された使用パターンに基づいて調整することを推奨します。時間の経過に伴いプロダクションデプロイメントを監視し続け、最適なパフォーマンスを維持するための調整を行ってください。

### Models のみ

#### Kubernetes

| 環境          | CPU                | メモリ              | ディスク           | 
| ------------ | ------------------ | ------------------ | ------------------ | 
| テスト/開発  | 2 コア             | 16 GB              | 100 GB             |
| プロダクション | 8 コア             | 64 GB              | 100 GB             |

数字は Kubernetes ワーカーノードごとです。

#### MySQL

| 環境          | CPU                | メモリ              | ディスク           | 
| ------------ | ------------------ | ------------------ | ------------------ | 
| テスト/開発  | 2 コア             | 16 GB              | 100 GB             |
| プロダクション | 8 コア             | 64 GB              | 500 GB             |

数字は MySQL ノードごとです。

### Weave のみ

#### Kubernetes

| 環境          | CPU                | メモリ              | ディスク           | 
| ------------ | ------------------ | ------------------ | ------------------ | 
| テスト/開発  | 4 コア             | 32 GB              | 100 GB             |
| プロダクション | 12 コア            | 96 GB              | 100 GB             |

数字は Kubernetes ワーカーノードごとです。

#### MySQL

| 環境          | CPU                | メモリ              | ディスク           | 
| ------------ | ------------------ | ------------------ | ------------------ | 
| テスト/開発  | 2 コア             | 16 GB              | 100 GB             |
| プロダクション | 8 コア             | 64 GB              | 500 GB             |

数字は MySQL ノードごとです。

### Models と Weave

#### Kubernetes

| 環境          | CPU                | メモリ              | ディスク           | 
| ------------ | ------------------ | ------------------ | ------------------ | 
| テスト/開発  | 4 コア             | 32 GB              | 100 GB             |
| プロダクション | 16 コア            | 128 GB             | 100 GB             |

数字は Kubernetes ワーカーノードごとです。

#### MySQL

| 環境          | CPU                | メモリ              | ディスク           | 
| ------------ | ------------------ | ------------------ | ------------------ | 
| テスト/開発  | 2 コア             | 16 GB              | 100 GB             |
| プロダクション | 8 コア             | 64 GB              | 500 GB             |

数字は MySQL ノードごとです。

## クラウドプロバイダーのインスタンスの推奨事項

### サービス

| クラウド      | Kubernetes | MySQL	                | オブジェクトストレージ   |   
| ------------ | ---------- | --------------------- | --------------------- | 
| AWS          | EKS        | RDS Aurora            | S3                    |
| GCP          | GKE        | Google Cloud SQL - Mysql | Google Cloud Storage (GCS) |
| Azure        | AKS        | Azure Database for Mysql | Azure Blob Storage    |


### マシンタイプ

これらの推奨事項は、クラウドインフラストラクチャーでの W&B の自己管理型デプロイメントの各ノードに適用されます。

#### AWS

| 環境          | K8s (Models のみ) | K8s (Weave のみ)   | K8s (Models&Weave) | MySQL              |  
| ------------ | ------------------ | ------------------ | ------------------- | ------------------ |  
| テスト/開発  | r6i.large          | r6i.xlarge         | r6i.xlarge          | db.r6g.large       | 
| プロダクション | r6i.2xlarge        | r6i.4xlarge        | r6i.4xlarge         | db.r6g.2xlarge     | 

#### GCP

| 環境          | K8s (Models のみ) | K8s (Weave のみ)   | K8s (Models&Weave) | MySQL              |  
| ------------ | ------------------ | ------------------ | ------------------- | ------------------ |  
| テスト/開発  | n2-highmem-2       | n2-highmem-4       | n2-highmem-4        | db-n1-highmem-2    | 
| プロダクション | n2-highmem-8       | n2-highmem-16      | n2-highmem-16       | db-n1-highmem-8    | 

#### Azure

| 環境          | K8s (Models のみ) | K8s (Weave のみ)   | K8s (Models&Weave) | MySQL               |  
| ------------ | ------------------ | ------------------ | ------------------- | ------------------- |  
| テスト/開発  | Standard_E2_v5     | Standard_E4_v5     | Standard_E4_v5      | MO_Standard_E2ds_v4 | 
| プロダクション | Standard_E8_v5     | Standard_E16_v5    | Standard_E16_v5     | MO_Standard_E8ds_v4 |