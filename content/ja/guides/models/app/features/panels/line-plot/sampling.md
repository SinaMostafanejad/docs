---
title: Point aggregation
menu:
  default:
    identifier: ja-guides-models-app-features-panels-line-plot-sampling
    parent: line-plot
weight: 20
---

Data Visualization の精度とパフォーマンスを向上させるために、折れ線グラフ内でポイント集約メソッドを使用します。ポイント集約モードには、[完全再現]({{< relref path="#full-fidelity" lang="ja" >}}) と [ランダムサンプリング]({{< relref path="#random-sampling" lang="ja" >}}) の 2 種類があります。W&B はデフォルトで完全再現モードを使用します。

## 完全再現

完全再現モードを使用すると、W&B はデータポイントの数に基づいて x 軸を動的なバケットに分割します。次に、各バケット内の最小値、最大値、および平均値を計算しながら、折れ線グラフのポイント集約をレンダリングします。

ポイント集約に完全再現モードを使用する主な利点は 3 つあります。

* 極端な値とスパイクを保持: データ内の極端な値とスパイクを保持します。
* 最小点と最大点のレンダリング方法を設定: W&B アプリを使用して、極端な値 (最小/最大) を影付きの領域として表示するかどうかをインタラクティブに決定します。
* データ精度を損なわずにデータを探索: W&B は、特定のデータポイントにズームインすると、x 軸のバケットサイズを再計算します。これにより、精度を損なわずにデータを探索できます。キャッシュは、以前に計算された集計を保存するために使用され、ロード時間を短縮するのに役立ちます。これは、大きなデータセットをナビゲートする場合に特に役立ちます。

### 最小点と最大点のレンダリング方法を設定

折れ線グラフの周囲に影付きの領域を表示して、最小値と最大値を表示または非表示にします。

次の画像は、青い折れ線グラフを示しています。薄い青色の影付き領域は、各バケットの最小値と最大値を表しています。

{{< img src="/images/app_ui/shaded-areas.png" alt="" >}}

折れ線グラフで最小値と最大値をレンダリングするには、次の 3 つの方法があります。

* **Never**: 最小/最大値は影付きの領域として表示されません。x 軸バケット全体の集計線のみを表示します。
* **On hover**: 最小/最大値の影付き領域は、グラフにカーソルを合わせると動的に表示されます。このオプションを使用すると、表示がすっきりした状態に保たれると同時に、範囲をインタラクティブに検査できます。
* **Always**: 最小/最大値の影付き領域は、グラフ内のすべてのバケットに対して常に表示されるため、常に値の全範囲を可視化できます。グラフで可視化される Run が多い場合は、視覚的なノイズが発生する可能性があります。

デフォルトでは、最小値と最大値は影付きの領域として表示されません。影付きの領域オプションのいずれかを表示するには、次の手順に従います。

{{< tabpane text=true >}}
{{% tab header="ワークスペース 内のすべてのグラフ" value="all_charts" %}}
1. W&B の Project に移動します。
2. 左側のタブにある [**Workspace**] アイコンを選択します。
3. 画面右上にある歯車アイコン ([**Add panels**] ボタンの左隣) を選択します。
4. 表示される UI スライダーから、[**Line plots**] を選択します。
5. [**Point aggregation**] セクション内で、[**Show min/max values as a shaded area**] ドロップダウンメニューから [**On over**] または [**Always**] を選択します。
{{% /tab %}}

{{% tab header="ワークスペース 内の個々のグラフ" value="single_chart"%}}
1. W&B の Project に移動します。
2. 左側のタブにある [**Workspace**] アイコンを選択します。
3. 完全再現モードを有効にする折れ線グラフ パネルを選択します。
4. 表示されるモーダル内で、[**Show min/max values as a shaded area**] ドロップダウンメニューから [**On hover**] または [**Always**] を選択します。
{{% /tab %}}
{{< /tabpane >}}


### データ精度を損なわずにデータを探索

極端な値やスパイクなどの重要なポイントを見逃すことなく、データセットの特定領域を分析します。折れ線グラフを拡大すると、W&B は各バケット内の最小値、最大値、および平均値を計算するために使用されるバケットサイズを調整します。

{{< img src="/images/app_ui/zoom_in.gif" alt="" >}}

W&B は、x 軸をデフォルトで 1000 個のバケットに動的に分割します。W&B は、各バケットについて、次の値を計算します。

- **Minimum**: そのバケット内の最小値。
- **Maximum**: そのバケット内の最大値。
- **Average**: そのバケット内のすべてのポイントの平均値。

W&B は、完全なデータ表現を保持し、すべてのプロットに極端な値を含める方法でバケット内の値をプロットします。1,000 ポイント以下にズームインすると、完全再現モードでは、追加の集計なしですべてのデータポイントがレンダリングされます。

折れ線グラフを拡大するには、次の手順に従います。

1. W&B の Project に移動します。
2. 左側のタブにある [**Workspace**] アイコンを選択します。
3. 必要に応じて、折れ線グラフ パネルを Workspace に追加するか、既存の折れ線グラフ パネルに移動します。
4. クリックしてドラッグし、拡大する特定の領域を選択します。

{{% alert title="折れ線グラフのグループ化と式" %}}
折れ線グラフのグループ化を使用すると、W&B は選択されたモードに基づいて以下を適用します。

- **Non-windowed sampling (グループ化)**: x 軸上の Run 間でポイントを整列させます。複数のポイントが同じ x 値を共有する場合、平均が取得されます。それ以外の場合は、個別のポイントとして表示されます。
- **Windowed sampling (グループ化と式)**: x 軸を 250 個のバケットまたは最長の線のポイント数 (どちらか小さい方) に分割します。W&B は、各バケット内のポイントの平均を取ります。
- **Full fidelity (グループ化と式)**: 非ウィンドウ サンプリングと同様ですが、パフォーマンスと詳細のバランスを取るために、Run ごとに最大 500 ポイントを取得します。
{{% /alert %}}

## ランダムサンプリング

ランダムサンプリングは、1500 個のランダムにサンプリングされたポイントを使用して折れ線グラフをレンダリングします。ランダムサンプリングは、データポイントの数が非常に多い場合に、パフォーマンス上の理由から役立ちます。

{{% alert color="warning" %}}
ランダムサンプリングは、非決定論的にサンプリングします。これは、ランダムサンプリングがデータ内の重要な外れ値またはスパイクを除外することがあり、データ精度が低下することを意味します。
{{% /alert %}}

### ランダムサンプリングを有効にする
デフォルトでは、W&B は完全再現モードを使用します。ランダムサンプリングを有効にするには、次の手順に従います。

{{< tabpane text=true >}}
{{% tab header="ワークスペース 内のすべてのグラフ" value="all_charts" %}}
1. W&B の Project に移動します。
2. 左側のタブにある [**Workspace**] アイコンを選択します。
3. 画面右上にある歯車アイコン ([**Add panels**] ボタンの左隣) を選択します。
4. 表示される UI スライダーから、[**Line plots**] を選択します。
5. [**Point aggregation**] セクションから [**Random sampling**] を選択します。
{{% /tab %}}

{{% tab header="ワークスペース 内の個々のグラフ" value="single_chart"%}}
1. W&B の Project に移動します。
2. 左側のタブにある [**Workspace**] アイコンを選択します。
3. ランダムサンプリングを有効にする折れ線グラフ パネルを選択します。
4. 表示されるモーダル内で、[**Point aggregation method**] セクションから [**Random sampling**] を選択します。
{{% /tab %}}
{{< /tabpane >}}

### サンプリングされていないデータへのアクセス

[W&B Run API]({{< relref path="/ref/python/public-api/run.md" lang="ja" >}}) を使用して、Run 中に記録されたメトリクスの完全な履歴にアクセスできます。次の例は、特定の Run から損失値を取得して処理する方法を示しています。

```python
# W&B API を初期化します
run = api.run("l2k2/examples-numpy-boston/i0wt6xua")

# 'Loss' メトリクスの履歴を取得します
history = run.scan_history(keys=["Loss"])

# 履歴から損失値を抽出します
losses = [row["Loss"] for row in history]
```
